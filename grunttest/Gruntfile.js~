module.exports = function(grunt) {

  grunt.initConfig({

    pkg: grunt.file.readJSON('package.json'),
    
	db: 'bikes',			//database name
	collection: 'ducati',		//collection name

	mongodump : {
	//a : 'car',
	  bikes : '<%= collection %>',     //database name :
            },
	
	compress: {
  		main: {
    			options: {
      			archive:'<%= db %><%= grunt.template.today("yyyy-mm-dd") %>.zip'
    			},
    			files: [
      			{
			 src: 'dump/<%= db %>/*'
			}, // includes files to zip
      			]
  		      }
		},

	mongorestore : {
	task : 'mongorestore',
	},

	unzip: {
    	unzip: '<%=grunt.template.today("yyyy-mm-dd") %>.zip',     //path(folder) : zip file name
       	},

	gitco: {
    	repo : 'https://github.com/bhushangoel/grunt-demo.git',
	},

	'gh-pages': {
    options: {
      // Task-specific options go here.
	repo : 'https://github.com/bhushangoel/grunt-demo.git',
	branch: 'cars',
	clone: 'https://github.com/bhushangoel/grunt-demo.git',
	message: 'committ',
    },
    src: ['<%= db %><%= grunt.template.today("yyyy-mm-dd") %>.zip']
  }

	
  });


grunt.loadNpmTasks('grunt-contrib-compress');
grunt.loadNpmTasks('grunt-gh-pages');
grunt.loadNpmTasks('grunt-gitco');

grunt.loadNpmTasks('grunt-zip');


grunt.registerTask('test', ['compress', 'gh-pages']);
grunt.registerTask('abc', ['mongodump','compress','gh-pages']);


//mongodump
grunt.registerMultiTask('mongodump', 'Dumps the mongodb', function() {
    
    console.log(this.target);
    console.log(this.data);
    console.log(this.name);
    //console.log(db);
    //console.log(coll);
	var myTerminal = require("child_process").exec,
    commandToBeExecuted = 'mongodump --db '+this.target+' --collection '+this.data+' --out dump/';
	
	console.log(commandToBeExecuted);
	myTerminal(commandToBeExecuted, function(error, stdout, stderr) {
    });
	//grunt.config.set('commandToBeExecuted.value', value);
});

//mongorestore
grunt.registerMultiTask('mongorestore', 'restore the mongodb', function() {
 	//console.log(this.target);
 	//console.log(this.data);
	var myTerminal = require("child_process").exec,
    	commandToBeExecuted = "mongorestore --db new --collection car dump/cars/sedan.bson";
	console.log(commandToBeExecuted);
	myTerminal(commandToBeExecuted, function(error, stdout, stderr) {
	});

});

//unzip
grunt.registerMultiTask('unzip', 'unzip the file', function() {
var myTerminal = require("child_process").exec,
    	commandToBeExecuted = "unzip "+ this.data +" -d "+ this.target;
	console.log(commandToBeExecuted);
	myTerminal(commandToBeExecuted, function(error, stdout, stderr) {
	});
});

/*grunt.registerTask('abc', 'commit to git', function() {
var github = new Github({
  username: "YOU_USER",
  password: "YOUR_PASSWORD",
  auth: "basic"
});

});*/

  grunt.registerTask('default', ['mongodump','compress','unzip','mongorestore','commit','gh-pages','gitco']);

};
